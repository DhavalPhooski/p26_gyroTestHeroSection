<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Spritesheet Demo - Parallax with Gyro</title>
        <link rel="stylesheet" href="optimized-parallax.css" />
    </head>
    <body>
        <div class="HomePage">
            <div class="HeroSection" id="hero">
                <div class="sprite title" data-depth="0.15"></div>
                <div class="sprite baseClouds" data-depth="0.65"></div>
                <div class="sprite baseClouds2" data-depth="0.65"></div>
                <div class="WindMillParent" data-depth="0.25">
                    <div class="sprite staticWindMill"></div>
                    <div class="sprite rotatingWindMill"></div>
                </div>
                <div class="WaterMillParent" data-depth="0.25">
                    <div class="sprite rotatingWaterMill1"></div>
                    <div class="sprite rotatingWaterMill2"></div>
                    <div class="sprite staticWaterMill"></div>
                    <div class="sprite Water"></div>
                </div>
                <div class="sprite titleCloud1" data-depth="0.5"></div>
                <div class="sprite titleCloud2" data-depth="0.7"></div>
                <div class="sprite titleCloud3" data-depth="0.10"></div>
                <div class="sprite stars"></div>
                <div class="sprite geometricCircleGrid"></div>
                <div class="sprite babbageMachine" data-depth="0.25"></div>
            </div>

            <div class="hourGlassLeftParent">
                <div class="sprite hourGlassLeftPillar"></div>
            </div>
            <div class="hourGlassRightParent">
                <div class="sprite hourGlassRightPillar"></div>
            </div>
            <div class="hourGlassTopParent">
                <div class="sprite hourGlassTop"></div>
            </div>
            <div class="hourGlassBaseParent">
                <div class="sprite hourGlassBase"></div>
            </div>
            <div class="MiddleSection">
                <div class="sprite MobileHourGlassLeftMiddle"></div>
                <div class="sprite MobileHourGlassRightMiddle"></div>

                <div class="sprite purpleClouds1"></div>
                <div class="sprite purpleClouds2"></div>
                <div class="sprite girlFall"></div>
                <div class="sprite guyFall"></div>
                <div class="sprite peachClouds1"></div>
                <div class="sprite peachClouds2"></div>

            </div>
            <div class="MiddleSection Shine">
                <div class="sprite upShine"></div>
                <div class="sprite downShine"></div>
            </div>
            <div class="FutureParent">
                <div class="sprite bgFutureBuild"></div>
                <div class="sprite bgFutureBuild2"></div>
                <div class="sprite foreGroundRoad"></div>
                <div class="BridgeAndTrainParent">
                    <div class="sprite train"></div>
                    <div class="sprite bridge"></div>
                </div>
            </div>
        </div>

        <!-- Gyro Enable Button (only shows on mobile) -->
        <button id="gyroBtn" style="
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            display: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        " onmouseover="this.style.transform='translateX(-50%) scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(0, 0, 0, 0.3)'" 
           onmouseout="this.style.transform='translateX(-50%) scale(1)'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.2)'">
            ðŸŽ¯ Enable Gyro Parallax
        </button>

        <!-- Optional: Visual debug info -->
        <div class="debug-info" id="debug">
            Mouse: <span id="mousePos">0, 0</span><br>
            Offset: <span id="offset">0px</span><br>
            FPS: <span id="fps">60</span><br>
            Mode: <span id="mode">Mouse</span>
        </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  "use strict";

  /* =======================
     DOM
  ======================= */
  const hero = document.getElementById("hero");
  const gyroBtn = document.getElementById("gyroBtn");
  if (!hero || !gyroBtn) return;

  const layers = hero.querySelectorAll("[data-depth]");

  /* =======================
     CONFIG (IMPORTANT)
  ======================= */
  const MOVE_X = 80;

  const ENTER_THRESHOLD = 15; // must cross this to change direction
  const EXIT_THRESHOLD  = 6;  // must return inside this to reset

  const DIRECTION_COOLDOWN = 350; // ms (prevents flicker)

  /* =======================
     STATE
  ======================= */
  let currentDirection = "center";
  let gyroEnabled = false;
  let lastDirectionChange = 0;

  /* =======================
     BASE TRANSFORMS
  ======================= */
  const baseTransforms = new WeakMap();

  layers.forEach(layer => {
    const t = getComputedStyle(layer).transform;
    baseTransforms.set(layer, t === "none" ? "" : t);
    layer.style.willChange = "transform";
  });

  /* =======================
     MOBILE + GYRO CHECK
  ======================= */
  const isMobile =
    /Android|iPhone|iPad|iPod/i.test(navigator.userAgent) ||
    window.innerWidth < 768;

  if (window.DeviceOrientationEvent && isMobile) {
    gyroBtn.style.display = "block";
  }

  /* =======================
     APPLY DIRECTION
  ======================= */
  function applyDirection(dir) {
    if (dir === currentDirection) return;

    const now = performance.now();
    if (now - lastDirectionChange < DIRECTION_COOLDOWN) return;

    lastDirectionChange = now;
    currentDirection = dir;

    layers.forEach(layer => {
      const depth = Number(layer.dataset.depth) || 0;
      let x = 0;

      if (dir === "left")  x = -MOVE_X * depth;
      if (dir === "right") x =  MOVE_X * depth;

      layer.style.transform =
        `translate3d(${x}px,0,0) ${baseTransforms.get(layer)}`;
    });
  }

  /* =======================
     GYRO HANDLER (STABLE)
  ======================= */
  function onGyroMove(e) {
    if (e.gamma == null) return;
    const g = e.gamma;

    if (currentDirection === "center") {
      if (g > ENTER_THRESHOLD) applyDirection("right");
      else if (g < -ENTER_THRESHOLD) applyDirection("left");
    } 
    else if (currentDirection === "right") {
      if (Math.abs(g) < EXIT_THRESHOLD) applyDirection("center");
    } 
    else if (currentDirection === "left") {
      if (Math.abs(g) < EXIT_THRESHOLD) applyDirection("center");
    }
  }

  /* =======================
     ENABLE GYRO
  ======================= */
  async function enableGyro() {
    if (gyroEnabled) return;

    if (typeof DeviceOrientationEvent.requestPermission === "function") {
      const res = await DeviceOrientationEvent.requestPermission();
      if (res !== "granted") return;
    }

    gyroEnabled = true;
    window.addEventListener("deviceorientation", onGyroMove, {
      passive: true
    });

    gyroBtn.textContent = "ðŸŽ¯ Gyro Active";
    gyroBtn.style.background =
      "linear-gradient(135deg,#11998e,#38ef7d)";
  }

  gyroBtn.addEventListener("click", enableGyro);
});
</script>
    </body>
</html>